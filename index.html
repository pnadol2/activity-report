<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تقرير النشاط - الكتابة فوق القالب</title>
<meta name="description" content="الكتابة مباشرة فوق قالب A4 كصورة واحدة.">

<style>
:root{
  /* عدّل هذه القيم (٪) لتطابق مربعات القالب لديك */
  --x-program: 22;  --y-program: 18;  --w-program: 56;  --h-program: 3.6;

  --x-teacher: 64;  --y-teacher: 27.5; --w-teacher: 27; --h-teacher: 3;
  --x-major:   33;  --y-major: 27.5; --w-major:   27; --h-major:   3;

  --x-class:   64;  --y-class: 31;   --w-class:   27; --h-class:   3;
  --x-term:    33;  --y-term:  31;   --w-term:    27; --h-term:    3;

  --x-day:     64;  --y-day:  34.4;  --w-day:     27; --h-day:     3;
  --x-date:    33;  --y-date: 34.4;  --w-date:    27; --h-date:    3;

  --x-period:  64;  --y-period:37.8; --w-period:  27; --h-period:  3;
  --x-place:   33;  --y-place: 37.8; --w-place:   27; --h-place:   3;

  --x-att:     64;  --y-att:  41.2;  --w-att:     27; --h-att:     3;
  --x-abs:     33;  --y-abs:  41.2;  --w-abs:     27; --h-abs:     3;

  --x-aud:     64;  --y-aud:  44.6;  --w-aud:     27; --h-aud:     3;
  --x-owner:   33;  --y-owner:44.6;  --w-owner:   27; --h-owner:   3;

  --x-goals:   16;  --y-goals: 52.2; --w-goals:   68; --h-goals:   6.2;
  --x-out:     16;  --y-out:   62.2; --w-out:     68; --h-out:     6.2;

  --x-ev1: 16;  --y-ev1:  72.8; --w-ev1: 32; --h-ev1: 14;
  --x-ev2: 52;  --y-ev2:  72.8; --w-ev2: 32; --h-ev2: 14;
  --x-ev3: 16;  --y-ev3:  88.0; --w-ev3: 32; --h-ev3: 14;
  --x-ev4: 52;  --y-ev4:  88.0; --w-ev4: 32; --h-ev4: 14;

  --font:"Tajawal","Cairo",system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Arabic",Arial,sans-serif;
}
*{box-sizing:border-box}
html,body{margin:0;background:#f5f7fb;color:#111;font-family:var(--font)}
.container{max-width:1100px;margin:14px auto;padding:0 12px}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin:10px 0}
h1{margin:.4rem 0}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:10px}
label{display:flex;flex-direction:column;gap:6px;font-weight:600}
input,textarea{padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;font:inherit}
textarea{resize:vertical}
.actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
button,.btn{background:#0ea5e9;color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
button.ghost{background:#fff;color:#111;border:1px solid #e5e7eb}

/* مسرح A4 */
.print-area{display:none}
.a4{position:relative;width:210mm;height:297mm;margin:0 auto;color:#000;overflow:hidden}
.a4 img.bg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

/* صناديق الكتابة فوق الصورة */
.ov{position:absolute;display:flex;align-items:center;justify-content:flex-start;
    padding:2mm 3mm; white-space:pre-wrap; line-height:1.25; color:#111; font-size:12pt}
.ov.small{font-size:11pt}
.ov.center{justify-content:center;text-align:center}
.ov img{width:100%;height:100%;object-fit:cover;border-radius:3px}

/* التموضع بالنِّسب (٪) */
[data-pos="program"]{left:calc(var(--x-program)*1%); top:calc(var(--y-program)*1%); width:calc(var(--w-program)*1%); height:calc(var(--h-program)*1%);}
[data-pos="teacher"]{left:calc(var(--x-teacher)*1%); top:calc(var(--y-teacher)*1%); width:calc(var(--w-teacher)*1%); height:calc(var(--h-teacher)*1%);}
[data-pos="major"]  {left:calc(var(--x-major)*1%);   top:calc(var(--y-major)*1%);   width:calc(var(--w-major)*1%);   height:calc(var(--h-major)*1%);}
[data-pos="class"]  {left:calc(var(--x-class)*1%);   top:calc(var(--y-class)*1%);   width:calc(var(--w-class)*1%);   height:calc(var(--h-class)*1%);}
[data-pos="term"]   {left:calc(var(--x-term)*1%);    top:calc(var(--y-term)*1%);    width:calc(var(--w-term)*1%);    height:calc(var(--h-term)*1%);}
[data-pos="day"]    {left:calc(var(--x-day)*1%);     top:calc(var(--y-day)*1%);     width:calc(var(--w-day)*1%);     height:calc(var(--h-day)*1%);}
[data-pos="date"]   {left:calc(var(--x-date)*1%);    top:calc(var(--y-date)*1%);    width:calc(var(--w-date)*1%);    height:calc(var(--h-date)*1%);}
[data-pos="period"] {left:calc(var(--x-period)*1%);  top:calc(var(--y-period)*1%);  width:calc(var(--w-period)*1%);  height:calc(var(--h-period)*1%);}
[data-pos="place"]  {left:calc(var(--x-place)*1%);   top:calc(var(--y-place)*1%);   width:calc(var(--w-place)*1%);   height:calc(var(--h-place)*1%);}
[data-pos="att"]    {left:calc(var(--x-att)*1%);     top:calc(var(--y-att)*1%);     width:calc(var(--w-att)*1%);     height:calc(var(--h-att)*1%);}
[data-pos="abs"]    {left:calc(var(--x-abs)*1%);     top:calc(var(--y-abs)*1%);     width:calc(var(--w-abs)*1%);     height:calc(var(--h-abs)*1%);}
[data-pos="aud"]    {left:calc(var(--x-aud)*1%);     top:calc(var(--y-aud)*1%);     width:calc(var(--w-aud)*1%);     height:calc(var(--h-aud)*1%);}
[data-pos="owner"]  {left:calc(var(--x-owner)*1%);   top:calc(var(--y-owner)*1%);   width:calc(var(--w-owner)*1%);   height:calc(var(--h-owner)*1%);}

[data-pos="goals"]  {left:calc(var(--x-goals)*1%);   top:calc(var(--y-goals)*1%);   width:calc(var(--w-goals)*1%);   min-height:calc(var(--h-goals)*1%);}
[data-pos="out"]    {left:calc(var(--x-out)*1%);     top:calc(var(--y-out)*1%);     width:calc(var(--w-out)*1%);     min-height:calc(var(--h-out)*1%);}

[data-pos="ev1"]    {left:calc(var(--x-ev1)*1%);     top:calc(var(--y-ev1)*1%);     width:calc(var(--w-ev1)*1%);     height:calc(var(--h-ev1)*1%);}
[data-pos="ev2"]    {left:calc(var(--x-ev2)*1%);     top:calc(var(--y-ev2)*1%);     width:calc(var(--w-ev2)*1%);     height:calc(var(--h-ev2)*1%);}
[data-pos="ev3"]    {left:calc(var(--x-ev3)*1%);     top:calc(var(--y-ev3)*1%);     width:calc(var(--w-ev3)*1%);     height:calc(var(--h-ev3)*1%);}
[data-pos="ev4"]    {left:calc(var(--x-ev4)*1%);     top:calc(var(--y-ev4)*1%);     width:calc(var(--w-ev4)*1%);     height:calc(var(--h-ev4)*1%);}

/* الطباعة */
@media print{
  @page { size: A4; margin: 0 }
  .no-print{display:none!important}
  body{background:#fff}
  .print-area{display:block}
}
</style>
</head>
<body>

<div class="container no-print">
  <h1>إدخال بيانات التقرير</h1>
  <div class="card">
    <div class="grid">
      <label>اسم البرنامج<input id="program"></label>
      <label>اسم المعلم/ـة<input id="teacher"></label>
      <label>التخصص<input id="major"></label>
      <label>الصف<input id="class"></label>
      <label>الفصل الدراسي<input id="term"></label>
      <label>اليوم<input id="day"></label>
      <label>التاريخ<input id="date" type="date"></label>
      <label>الحصة<input id="period"></label>
      <label>مكان التنفيذ<input id="place"></label>
      <label>الحضور<input id="att"></label>
      <label>الغياب<input id="abs"></label>
      <label>الفئة المستهدفة<input id="aud"></label>
      <label>المسؤول/ـة<input id="owner"></label>
    </div>
  </div>

  <div class="card">
    <h3>أهداف البرنامج</h3>
    <textarea id="goals" rows="3" placeholder="- هدف ١&#10;- هدف ٢"></textarea>
    <h3 style="margin-top:10px">الأثر الإيجابي للبرنامج</h3>
    <textarea id="out" rows="3" placeholder="- أثر ١&#10;- أثر ٢"></textarea>
  </div>

  <div class="card">
    <h3>الشواهد (٤ صور)</h3>
    <div class="actions">
      <label class="btn">رفع الصور
        <input id="ev" type="file" accept="image/*" multiple style="display:none">
      </label>
      <button id="btnPrint">معاينة/طباعة</button>
    </div>
  </div>

  <div class="card">
    <strong>ملاحظة:</strong> لو ما ركبت النصوص تمامًا داخل المربعات،
    عدّل القيم في أعلى الملف عند <code>:root</code> (مثل <code>--x-teacher</code>, <code>--y-teacher</code>) حتى تضبط 100%.
  </div>
</div>

<!-- مسرح الطباعة -->
<section id="printArea" class="print-area">
  <div class="a4" id="stage">
    <!-- صورة القالب A4 فقط -->
    <img id="tplImg" class="bg" src="assets/culture-report-page1.png" alt="قالب" />

    <!-- حقول نصية فوق الصورة -->
    <div class="ov center" data-pos="program" id="p-program"></div>

    <div class="ov" data-pos="teacher" id="p-teacher"></div>
    <div class="ov" data-pos="major"   id="p-major"></div>
    <div class="ov" data-pos="class"   id="p-class"></div>
    <div class="ov" data-pos="term"    id="p-term"></div>
    <div class="ov" data-pos="day"     id="p-day"></div>
    <div class="ov" data-pos="date"    id="p-date"></div>
    <div class="ov" data-pos="period"  id="p-period"></div>
    <div class="ov" data-pos="place"   id="p-place"></div>
    <div class="ov" data-pos="att"     id="p-att"></div>
    <div class="ov" data-pos="abs"     id="p-abs"></div>
    <div class="ov" data-pos="aud"     id="p-aud"></div>
    <div class="ov" data-pos="owner"   id="p-owner"></div>

    <div class="ov" data-pos="goals" id="p-goals"></div>
    <div class="ov" data-pos="out"   id="p-out"></div>

    <!-- الشواهد (صور) -->
    <div class="ov" data-pos="ev1"><img id="p-ev1" alt=""></div>
    <div class="ov" data-pos="ev2"><img id="p-ev2" alt=""></div>
    <div class="ov" data-pos="ev3"><img id="p-ev3" alt=""></div>
    <div class="ov" data-pos="ev4"><img id="p-ev4" alt=""></div>
  </div>
</section>

<script>
(function(){
  const $ = id => document.getElementById(id);

  // حمّل صورة القالب قبل الطباعة
  async function ensureTemplateLoaded() {
    const img = $("tplImg");
    if (!img) return;
    if (img.complete && img.naturalWidth>0) return;
    await new Promise((res,rej)=>{
      img.onload = ()=> res();
      img.onerror = ()=> res(); // لا توقف الطباعة لو فشلت
      img.src = img.src.split("?")[0] + "?t=" + Date.now(); // كسر كاش
    });
  }

  // ضع القيم داخل الحقول المتموضعة
  function fillOverlay(){
    const nl = t => (t||"").split(/\n/).map(s=>s.replace(/^[-•]\s*/,"• ")).join("\n");
    const v = id => ($(id)&&$(id).value)||"";

    $("p-program").textContent = v("program");
    $("p-teacher").textContent = v("teacher");
    $("p-major").textContent   = v("major");
    $("p-class").textContent   = v("class");
    $("p-term").textContent    = v("term");
    $("p-day").textContent     = v("day");
    $("p-date").textContent    = v("date");
    $("p-period").textContent  = v("period");
    $("p-place").textContent   = v("place");
    $("p-att").textContent     = v("att");
    $("p-abs").textContent     = v("abs");
    $("p-aud").textContent     = v("aud");
    $("p-owner").textContent   = v("owner");

    $("p-goals").textContent = nl(v("goals"));
    $("p-out").textContent   = nl(v("out"));
  }

  // الشواهد (٤ صور)
  const evInput = $("ev");
  evInput.addEventListener("change", e=>{
    const files = Array.from(e.target.files||[]).slice(0,4);
    files.forEach((f,idx)=>{
      const r=new FileReader();
      r.onload = ()=>{ $("p-ev"+(idx+1)).src = r.result; };
      r.readAsDataURL(f);
    });
    e.target.value="";
  });

  // زر الطباعة
  $("btnPrint").onclick = async ()=>{
    await ensureTemplateLoaded();
    fillOverlay();
    window.print();
  };

  // حتى لو طبع من قائمة المتصفح
  window.addEventListener("beforeprint", async ()=>{
    await ensureTemplateLoaded();
    fillOverlay();
  });

  // تاريخ افتراضي = اليوم
  const d = new Date(); const df = $("date"); if (df) df.value = d.toISOString().slice(0,10);
})();
</script>
</body>
</html>
