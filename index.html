<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>برامج الأنشطة الطلابية - تقرير</title>
<meta name="description" content="قالب تقرير نشاط عربي مع شواهد، طباعة PDF و Word">

<style>
:root{
  --bg:#f7f7f9; --fg:#111; --muted:#6b7280; --card:#fff; --border:#e5e7eb;
  --accent:#0ea5e9; --print-fg:#000;
  --font:"Tajawal","Cairo",system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Arabic",Arial,sans-serif;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:var(--font)}

/* Header (on-screen) */
.header{
  background:linear-gradient(90deg,#0f766e,#198754);
  color:#fff; padding:16px 12px 10px; border-bottom:4px solid rgba(255,255,255,.15);
}
.header .top{display:flex;justify-content:space-between;align-items:center;gap:12px}
.header .badge{background:#fff;color:#0f172a;padding:8px 16px;border-radius:999px;font-weight:800}
.container{max-width:1100px;margin:16px auto 24px;padding:0 14px}
.actions{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 0}
button,.btn{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
button.ghost{background:#fff;color:var(--fg);border:1px solid var(--border)}
.small{font-size:.92rem;color:var(--muted)}

.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin:12px 0}
.card h2{margin:.25rem 0 1rem}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
label{display:flex;flex-direction:column;gap:6px;font-weight:600}
input,textarea{padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff;font:inherit}
textarea{resize:vertical}

/* Evidence - 4 slots */
.evd-4{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.slot{border:1px dashed var(--border);border-radius:12px;background:#fff;overflow:hidden;position:relative;min-height:160px}
.slot img{width:100%;height:160px;object-fit:cover;display:block}
.slot .cap{padding:6px 8px;font-size:.9rem;border-top:1px solid var(--border)}
.slot .remove{position:absolute;top:6px;left:6px;background:#fff;color:#b91c1c;border:1px solid #fecaca;border-radius:8px;padding:4px 8px;cursor:pointer}

/* PRINT */
.print-area{display:none}
.report{padding:12mm 12mm;color:var(--print-fg)}
/* صورة القالب A4 */
.report .tpl{width:100%;display:block;margin:0 0 8mm}
/* جداول ونصوص */
.info-table{width:100%;border-collapse:collapse;margin:8px 0 12px}
.info-table th,.info-table td{border:1px solid #999;padding:6px 8px;text-align:right;vertical-align:top}
.para{min-height:18px;border:1px solid #bbb;padding:8px;border-radius:6px;margin:4px 0 10px;white-space:pre-wrap}
.ev4-print{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.ev4-print .box{border:1px solid #bbb;border-radius:6px;overflow:hidden;background:#fff}
.ev4-print img{width:100%;height:180px;object-fit:cover;display:block}
.sign-table{width:100%;border-collapse:collapse;margin-top:8px}
.sign-table th,.sign-table td{border:1px solid #999;padding:6px 8px;text-align:right}
.footer-line{display:flex;justify-content:space-between;margin-top:8mm;font-size:.95rem;color:#111}

@media print{
  @page { size: A4; margin: 10mm }
  .no-print{display:none !important}
  body{background:#fff}
  .print-area{display:block}
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header no-print">
  <div class="top">
    <div class="badge">برامج الأنشطة الطلابية</div>
    <div>وزارة التعليم</div>
  </div>
  <div class="container">
    <h1 id="docTitle" contenteditable="true" spellcheck="false" style="margin:8px 0 0">تعزيز الثقة بالنفس والشعور بالمسؤولية</h1>
    <p id="docSub" contenteditable="true" class="small" style="margin:6px 0 0">مجال المواطنة والحياة</p>
    <div class="actions">
      <button id="btnPreview">معاينة للطباعة / PDF</button>
      <button id="btnWord">تصدير Word</button>
      <label class="btn ghost">
        فتح بيانات JSON
        <input id="openJson" type="file" accept="application/json" style="display:none">
      </label>
      <a id="btnSave" class="btn" href="#" download="report.json">حفظ البيانات</a>
    </div>
  </div>
</header>

<main class="container no-print">
  <!-- البيانات -->
  <section class="card">
    <h2 contenteditable="true" id="titleBasic">البيانات الأساسية</h2>
    <div class="grid">
      <label>إدارة التعليم<input id="eduDir" placeholder="تعليم ..."></label>
      <label>اسم المدرسة<input id="school"></label>
      <label>القسم<input id="dept" placeholder="النشاط الطلابي / ..."></label>
      <label>اسم المعلم/ـة<input id="teacher"></label>
      <label>التخصص<input id="major"></label>
      <label>الصف<input id="class"></label>
      <label>الفصل الدراسي<input id="term"></label>
      <label>اليوم<input id="day" placeholder="الثلاثاء"></label>
      <label>التاريخ<input id="date_g" type="date"></label>
      <label>الحصة<input id="period" placeholder="الثانية"></label>
      <label>اسم البرنامج<input id="program"></label>
      <label>مكان التنفيذ<input id="place"></label>
      <label>الحضور<input id="attendance" placeholder="34"></label>
      <label>الغياب<input id="absence" placeholder="1"></label>
      <label>الفئة المستهدفة<input id="audience"></label>
      <label>المسؤول/ـة<input id="owner"></label>
    </div>
  </section>

  <!-- الأهداف -->
  <section class="card">
    <h2 id="titleGoals" contenteditable="true">أهداف البرنامج</h2>
    <textarea id="goals" rows="3" placeholder="- تنمية المسؤولية لدى الطلبة
- تعزيز التعاون والتقدير والاحترام"></textarea>
  </section>

  <!-- الأثر الإيجابي -->
  <section class="card">
    <h2 id="titleOutcomes" contenteditable="true">الأثر الإيجابي للبرنامج</h2>
    <textarea id="outcomes" rows="3" placeholder="- تنمية مهارات القيادة والعمل الجماعي
- غرس قيمة العطاء وتنمية روح المسؤولية"></textarea>
  </section>

  <!-- الشواهد (٤ صور) -->
  <section class="card">
    <h2 id="titleEvidence" contenteditable="true">الشواهد (٤ صور)</h2>
    <div class="small">ارفع ٤ صور (سيتم الاحتفاظ بأول أربع صور فقط).</div>
    <div class="actions">
      <label class="btn">رفع الصور (حتى 4)
        <input id="evImages" type="file" accept="image/*" multiple style="display:none">
      </label>
    </div>
    <div id="slots" class="evd-4" style="margin-top:10px">
      <div class="slot" data-i="0"><div class="cap">الصورة 1</div></div>
      <div class="slot" data-i="1"><div class="cap">الصورة 2</div></div>
      <div class="slot" data-i="2"><div class="cap">الصورة 3</div></div>
      <div class="slot" data-i="3"><div class="cap">الصورة 4</div></div>
    </div>
  </section>

  <!-- التوقيعات -->
  <section class="card">
    <h2 id="titleSign" contenteditable="true">التوقيعات</h2>
    <div class="grid">
      <label>مدير/ة المدرسة<input id="signPrincipal" placeholder="اسم المدير/ة"></label>
      <label>رائد/ة النشاط<input id="signLeader" placeholder="اسم رائد/ة النشاط"></label>
    </div>
  </section>
</main>

<!-- PRINT -->
<section id="printArea" class="print-area">
  <div class="report">

    <!-- صورة القالب A4 (ملفك في assets/culture-report-page1.png) -->
    <img class="tpl" src="assets/culture-report-page1.png" alt="قالب الطباعة">

    <!-- عنوان ومعلومات عامة -->
    <h1 id="pDocTitle" style="margin:0 0 4px">تعزيز الثقة بالنفس والشعور بالمسؤولية</h1>
    <div class="small" id="pSub" style="margin:0 0 6px">مجال المواطنة والحياة</div>

    <table class="info-table">
      <tr><th>اسم المعلم/ـة</th><td id="pTeacher"></td><th>التخصص</th><td id="pMajor"></td></tr>
      <tr><th>الصف</th><td id="pClass"></td><th>الفصل الدراسي</th><td id="pTerm"></td></tr>
      <tr><th>اليوم</th><td id="pDay"></td><th>التاريخ</th><td id="pDateG"></td></tr>
      <tr><th>الحصة</th><td id="pPeriod"></td><th>مكان التنفيذ</th><td id="pPlace"></td></tr>
      <tr><th>الحضور</th><td id="pAttendance"></td><th>الغياب</th><td id="pAbsence"></td></tr>
      <tr><th>الفئة المستهدفة</th><td id="pAudience"></td><th>المسؤول/ـة</th><td id="pOwner"></td></tr>
      <tr><th>اسم البرنامج</th><td id="pProgram" colspan="3"></td></tr>
    </table>

    <h2 id="pTitleGoals">أهداف البرنامج</h2>
    <div id="pGoals" class="para"></div>

    <h2 id="pTitleOutcomes">الأثر الإيجابي للبرنامج</h2>
    <div id="pOutcomes" class="para"></div>

    <h2 id="pTitleEvidence">الشواهد</h2>
    <div id="pEvGrid" class="ev4-print">
      <div class="box"><img id="pImg0" alt=""></div>
      <div class="box"><img id="pImg1" alt=""></div>
      <div class="box"><img id="pImg2" alt=""></div>
      <div class="box"><img id="pImg3" alt=""></div>
    </div>

    <h2 id="pTitleSign">التوقيعات</h2>
    <table class="sign-table">
      <tr><th>مدير/ة المدرسة</th><td id="pSignPrincipal"></td></tr>
      <tr><th>رائد/ة النشاط</th><td id="pSignLeader"></td></tr>
    </table>

    <div class="footer-line">
      <div>أُعد بواسطة: <span id="pOwner2"></span></div>
      <div>تاريخ الطباعة: <span id="pPrintDate"></span></div>
    </div>
  </div>
</section>

<script>
(function(){
  const $ = id => document.getElementById(id);

  // تعبئة تاريخ اليوم تلقائياً
  (function(){ const d = new Date(); const el=$("date_g"); if(el) el.value = d.toISOString().slice(0,10); })();

  // حقول الإدخال
  const F = ["eduDir","school","dept","teacher","major","class","term","day","date_g","period","program","place","attendance","absence","audience","owner","signPrincipal","signLeader"];
  const get = id => ($(id)?.value || "");
  const set = (id,val)=>{ const el=$(id); if(el) el.textContent = (val||""); };

  // الشواهد: 4 صور
  const slots = Array.from(document.querySelectorAll(".slot"));
  const imgs = [null,null,null,null];
  function putImageInSlot(url, i){
    if(i>3) return;
    const s = slots[i]; s.innerHTML = "";
    const img = document.createElement("img"); img.src = url; s.appendChild(img);
    const cap = document.createElement("div"); cap.className="cap"; cap.contentEditable=true; cap.textContent="وصف الشاهد (اختياري)";
    cap.oninput = ()=> s.dataset.cap = cap.textContent;
    s.appendChild(cap);
    const rm = document.createElement("button"); rm.className="remove"; rm.textContent="حذف";
    rm.onclick = ()=>{ imgs[i]=null; s.innerHTML='<div class="cap">الصورة '+(i+1)+'</div>'; delete s.dataset.cap; };
    s.appendChild(rm);
    imgs[i]=url;
  }
  $("evImages").addEventListener("change", e=>{
    const files = Array.from(e.target.files||[]).slice(0,4);
    files.forEach((f,idx)=>{
      const r = new FileReader();
      r.onload = ()=> putImageInSlot(r.result, idx);
      r.readAsDataURL(f);
    });
    e.target.value="";
  });

  // حفظ JSON
  $("btnSave").onclick = (e)=>{
    const data = {};
    F.forEach(f=> data[f]=get(f));
    data.headings = {
      docTitle: $("docTitle").textContent,
      docSub: $("docSub").textContent,
      goals: $("titleGoals").textContent,
      outcomes: $("titleOutcomes").textContent,
      evidence: $("titleEvidence").textContent,
      sign: $("titleSign").textContent
    };
    data.evidence4 = imgs.map((u,i)=> ({url:u, cap: (slots[i] && slots[i].dataset.cap)||""}));
    const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url = URL.createObjectURL(blob); e.currentTarget.href=url; e.currentTarget.download="report.json";
    setTimeout(()=>URL.revokeObjectURL(url),4000);
  };

  // فتح JSON
  $("openJson").addEventListener("change", ev=>{
    const f=ev.target.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=()=>{
      try{
        const d=JSON.parse(r.result);
        F.forEach(k=> { if(d[k]!==undefined) $(k).value=d[k]; });
        if(d.headings){
          $("docTitle").textContent=d.headings.docTitle||$("docTitle").textContent;
          $("docSub").textContent=d.headings.docSub||$("docSub").textContent;
          $("titleGoals").textContent=d.headings.goals||$("titleGoals").textContent;
          $("titleOutcomes").textContent=d.headings.outcomes||$("titleOutcomes").textContent;
          $("titleEvidence").textContent=d.headings.evidence||$("titleEvidence").textContent;
          $("titleSign").textContent=d.headings.sign||$("titleSign").textContent;
        }
        if(Array.isArray(d.evidence4)){
          d.evidence4.slice(0,4).forEach((it,idx)=>{
            if(it && it.url){ putImageInSlot(it.url, idx); if(slots[idx]) slots[idx].dataset.cap=it.cap||""; }
          });
        }
      }catch(e){ alert("ملف غير صالح"); }
    };
    r.readAsText(f);
  });

  // تجهيز نسخة الطباعة
  function fillPrint(){
    set("pDocTitle", $("docTitle").textContent);
    set("pSub", $("docSub").textContent);
    set("pTeacher", get("teacher")); set("pMajor", get("major"));
    set("pClass", get("class")); set("pTerm", get("term"));
    set("pDay", get("day")); set("pDateG", get("date_g"));
    set("pPeriod", get("period")); set("pPlace", get("place"));
    set("pAttendance", get("attendance")); set("pAbsence", get("absence"));
    set("pAudience", get("audience")); set("pOwner", get("owner")); set("pOwner2", get("owner"));
    set("pProgram", get("program"));

    set("pTitleGoals", $("titleGoals").textContent);
    set("pTitleOutcomes", $("titleOutcomes").textContent);
    set("pTitleEvidence", $("titleEvidence").textContent);
    set("pTitleSign", $("titleSign").textContent);

    // نصوص الفقرات
    const nl2ul = t => {
      const items = (t||"").split(/\n+/).map(s=>s.trim()).filter(Boolean);
      if(items.length<=1) return t;
      return items.map(x=> x.replace(/^[-•]\s*/,"")).map(x=>"• "+x).join("\n");
    };
    $("pGoals").textContent = nl2ul(get("goals"));
    $("pOutcomes").textContent = nl2ul(get("outcomes"));

    // صور الشواهد الأربعة
    [0,1,2,3].forEach(i=>{
      const u = imgs[i];
      const cap = (slots[i] && slots[i].dataset.cap) || "";
      const imgEl = $("pImg"+i);
      if(u){ imgEl.src = u; imgEl.alt = cap; }
      else { imgEl.removeAttribute("src"); imgEl.alt=""; }
    });

    $("pPrintDate").textContent = new Date().toLocaleDateString("ar-SA");
  }

  // المعاينة + Word + تجهيز تلقائي للطباعة
  $("btnPreview").onclick = ()=>{ fillPrint(); window.print(); };
  $("btnWord").onclick = ()=>{
    fillPrint();
    const content = document.querySelector("#printArea").innerHTML;
    const html = `<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"></head><body>${content}</body></html>`;
    const blob = new Blob([html], {type:"application/msword"});
    const url = URL.createObjectURL(blob); const a=document.createElement("a");
    a.href=url; a.download="تقرير-نشاط.doc"; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),4000);
  };
  window.addEventListener('beforeprint', ()=> { try{ fillPrint(); }catch(e){} });
})();
</script>
</body>
</html>
